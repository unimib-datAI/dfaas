# DFaaS: Decentralized Function-as-a-Service for Federated Edge 

This repository contains DFaaS, a novel decentralized FaaS-based architecture
designed to automatically and autonomously balance the traffic load across edge
nodes belonging to federated Edge Computing ecosystems.

DFaaS implementation relies on an overlay peer-to-peer network and a distributed
control algorithm that takes decisions on load redistribution. Although
preliminary, our results confirm the feasibility of the approach, showing that
the system can transparently redistribute the load across edge nodes when they
become overloaded.

Our prototype is based on OpenFaaS CE and implements the control logic within Go
P2P agents.

This research is conducted by the DatAI (formerly Insid&s) and
[REDS](https://redslab.altervista.org/) laboratories of the University of
Milano-Bicocca.

If you wish to reuse this source code, please consider citing our article
describing the first prototype:

```
@inproceedings{Ciavotta_DFaaS_2021,
    author = {Ciavotta, Michele and Motterlini, Davide and Savi, Marco and Tundo, Alessandro},
    doi    = {10.1109/CloudNet53349.2021.9657141},
    pages  = {1--4},
    series = {2021 IEEE 10th International Conference on Cloud Networking (CloudNet)},
    title  = {{DFaaS: Decentralized Function-as-a-Service for Federated Edge Computing}},
    url    = {https://ieeexplore.ieee.org/document/9657141},
    year   = {2021}
}
```

## Scenario & Architecture

![Scenario](images/Scenario-crop.png)

The above figure depicts the considered network scenario. A set of
geographically-distributed _FaaS-enabled edge nodes_ (or simply _edge nodes_) is
deployed at the edge of the access network. 

Each of these nodes deploys a _DFaaS platform_ for the execution of _serverless
functions_, and is connected to a wireless or wired _access point_ (e.g. a base
station, a broadband network gateway, a WiFi access point, etc.).

The edge node can receive functions' execution _requests_, in the form of HTTP
requests, generated by the _users_ served by the access point.

The following image summarizes the DFaaS architecture:

![Architecture](images/Arch-crop.png)

For more information about the architecture, see
[docs/overview.md](docs/overview.md) file.

## How to run DFaaS

**DFaaS is currently at a prototype stage.** It relies on
[HAProxy](https://www.haproxy.org/) for the proxy component, [OpenFaaS
CE](https://www.openfaas.com/) as the Function-as-a-Service platform, and
[Prometheus](https://prometheus.io/) for metrics collection. Kubernetes is the
only supported deployment environment.

The DFaaS prototype has been tested with [Ubuntu 24.04.3
LTS](https://releases.ubuntu.com/noble/) and [K3S](https://k3s.io/) as the
Kubernetes distribution.

We recommend starting with fresh virtual machines (VMs) running Ubuntu. You can
deploy one DFaaS platform per VM. To assist with setup, a collection of Ansible
playbooks is available.

For more information about DFaaS, refer to the documentation in the
[`docs`](docs) directory.

### Automated deployment with Ansible

Install Ansible on the control node following the [official
documentation](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)
(use the Ansible PPA). Then use the provided playbook
[`setup_playbook.yaml`](setup_playbook.yaml) to deploy a DFaaS node on a
specific managed node specified in an inventory file. Note that you can specify
multiple managed nodes.

An example of `inventory.yaml` file is

```yaml
all:
  hosts:
    <node-name>:
      ansible_host: <ip_address>
      ansible_user: <user>
      ansible_password: <password>
      ansible_become: true
```

We assume that the managed node has a user with root privileges and can connect
via SSH with a password. This is for testing purposes only!

To test the inventory, you can try the [example
playbook](https://docs.ansible.com/ansible/latest/getting_started/get_started_playbook.html)
on the official Ansible documentation.

**Important:** on the control node you need to have the DFaaS Git repository and
to build the DFaaS Agent. This can be done with the following:

```console
$ git clone https://github.com/unimib-datAI/dfaas.git
$ sudo apt install golang-go
$ go build -C dfaas/dfaasagent
```

Then you can run the playbook with ansible-playbook (make sure to be on the
DFaaS directory!):

```console
$ ansible-playbook -i inventory.yaml setup_playbook.yaml
```

This deploys a basic, fully functional DFaaS node using the Node Margin
Strategy. See [here](docs/agent-strategies.md) for a list of available
strategies for the agents.

You can make automatic calls to the node with k6. More information
about it in the [dedicated directory](k6).

If you have four different VMs it's recommended to deploy the entire system
exploiting the playbook and configuration files in
[`test_environment`](test_environment). This is still a work in progress.

### Deploy functions

Use the [`k8s/scripts/deploy-functions.sh`](k8s/scripts/deploy-functions.sh)
script to automatically deploy the default functions to the local DFaaS
instance. If you use the Ansible playbook, this step is done automatically.

We also created a basic ML inference function for OpenFaaS named
`image-classification`. Refer to [its
documentation](functions/image-classification/README.md) for more details.

### Invoke a function

Each node exposes HAProxy with port `30080` on the node's IP address. Only
`http` protocol is supported. You can use any program to make a call, as
example:

```console
$ curl -i http://127.0.0.1:30080/function/figlet -d 'Hello DFaaS world!'
```

In this case we assume that you have deployed the figlet function.

### Forwarding traffic as a malicious node

You can impersonate a malicious node that is not part of the federation by
adding the header `Dfaas-Node-Id` with a value that is not a valid peer id of
the network (e.g., `Dfaas-Node-Id: malicious-id`). All of its requests will be
rejected.

### Troubleshooting

See and follow the logs of the DFaaS Agent on the local instance:

```console
$ POD=$(sudo kubectl get pods -l app=dfaas-agent -o jsonpath="{.items[0].metadata.name}")
$ sudo kubectl logs --follow $POD
```

## Emulator

Until commit 7a8512b, an emulator was available in the [emulator
directory](https://github.com/unimib-datAI/dfaas/tree/7a8512be642321dfad8638b1c422ea59f3a98b32/emulator),
allowing multiple DFaaS edge nodes to be emulated on a single machine using
Docker and [Containernet](https://containernet.github.io/). The emulator was
removed when DFaaS migrated to Kubernetes (k3s), which requires a separate VM
for each node. The recommended approach is now to run multiple VMs that can
automatically connect on a hypervisor, which is the method we currently use.

## Simulator

We also provide a simulator to test and compare different load balancing
techniques. The simulation code is available into the [simulation
directory](simulation). Data gathered by the DFaaS system used for simulation
are available [here](simulation/data).

For more information read associated [README](simulation/README.md) file.

## License

Copyright Â© 2021-2026 The DFaaS Authors.

The source code in this repository is licensed under the GNU Affero General
Public License (AGPL), version 2.0 or later. See the [LICENSE](LICENSE) file for
more information.

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU Affero General Public License for more details.

The complete list of The DFaaS Authors can be fond in the [AUTHORS](AUTHORS)
file or in the [contributors
page](https://github.com/unimib-datAI/dfaas/graphs/contributors) on the DFaaS
GitHub repository.
